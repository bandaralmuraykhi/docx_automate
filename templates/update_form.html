{% extends 'base.html' %}

{% block title %}Update Form{% endblock %}

{% block content %}
<style>
    .cell-item {
        display: inline-block;
        padding: 5px 10px;
        margin: 5px;
        background-color: #f1f1f1;
        color: black;
        border-radius: 5px;
        cursor: pointer;
        user-select: none;
    }
    .cell-item.selected {
        background-color:hsl(217, 71%, 53%)	;
        color: #fff;
    }
    .main-content{
        display: flex;
        flex-direction: column;
        align-items: stretch;
        margin-left: 3rem;
        margin-right: 3rem;
        margin-top: 1rem;
    }
    .form-group {
    display: grid;
    align-items: stretch;
    justify-items: stretch;
    align-content: space-between;
    }
</style>

<div class="main-content">
    <h1 class="title">Update Form</h1>

    <form method="POST" class="mb-3">
        {{ form.hidden_tag() }}
        <div class="form-group">
            {{ form.form_name.label(class="form-label") }}
            {{ form.form_name(class="form-control input is-primary") }}
        </div>
        <div class="form-group mt-2 mb-2">
            <label class="form-label">Selected Cells</label>
            <div id="cell-container">
                {% for cell in form.selected_cells.choices %}
                <span class="cell-item {% if cell[0] in form.selected_cells.data %} selected {% endif %} m-0 p-2" data-value="{{ cell[0] }}">{{ cell[1] }}</span>
                {% endfor %}
            </div>
            <select multiple class="form-control" id="selected_cells" name="selected_cells" style="display: none;">
                {% for cell in form.selected_cells.choices %}
                <option value="{{ cell[0] }}" {% if cell[0] in form.selected_cells.data %} selected {% endif %}>{{ cell[1] }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            {{ form.submit(class="button is-primary") }}
        </div>
    </form>

    {% with messages = get_flashed_messages() %}
    {% if messages %}
    <div class="alert alert-info">
        {% for message in messages %}
        {{ message }}
        {% endfor %}
    </div>
    {% endif %}
    {% endwith %}
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        $('.cell-item').click(function() {
            $(this).toggleClass('selected');
            updateSelectedCells();
        });

        function updateSelectedCells() {
            $('#selected_cells').empty();
            $('.cell-item.selected').each(function() {
                var value = $(this).data('value');
                $('#selected_cells').append($('<option>', {
                    value: value,
                    text: value,
                    selected: true
                }));
            });
        }
    });
</script>
{% endblock %}